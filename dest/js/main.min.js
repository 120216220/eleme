var elemeApp=angular.module("eleme",["ngRoute","elemeDirectives","elemeCtrl","elemeServices"]);elemeApp.run(["$rootScope","$location",function(e,t){e.locationpath=t.path().slice(1).split(/\W+/g)}]),elemeApp.config(["$routeProvider",function(e){e.when("/index",{templateUrl:"tpls/main.html",controller:"mainCtrl"}).otherwise({redirectTo:"/index"})}]),angular.$=function(e){return e=angular.isString(e)?document.querySelectorAll(e):e,angular.element(e)},angular.element.prototype.find=function(e){if(!e)return angular.$();var t,r=document.querySelectorAll(e),n=this[0].getElementsByTagName("*"),a=[],i=[],o=[];for(t=0;t<r.length;t++)a.push(r[t]);for(t=0;t<n.length;t++)i.push(n[t]);for(t=0;t<a.length;t++)-1!==i.indexOf(a[t])&&o.push(a[t]);return angular.$(o)},angular.element.prototype.parents=function(e){var t,r,n=this[0],a=document.querySelectorAll(e),i=[];if(!e)return angualr.$(this[0].parentNode);for(t=0;t<a.length;t++)i.push(a[t]);for(;n&&"HTML"!=n.nodeName;)n=n.parentNode,-1!==i.indexOf(n)&&(r=n);return angular.$(r)},angular.module("elemeCtrl",[]).controller("sidebarCartCtrl",["$scope",function(e){}]).controller("sidebarHistoryCtrl",["$scope",function(e){}]).controller("sidebarMessageCtrl",["$scope",function(e){}]).controller("mainCtrl",["$scope","slideActivities","filtername","rstStream",function(e,t,r,n){e.rstCategories=r.query(),e.rstStream=n,e.rstStream.restaurants=n.restaurants.query(),e.activities=t.query()}]),angular.module("elemeDirectives",[]).directive("sidebar",function(){return{scope:{},restrict:"E",templateUrl:"tpls/sidebar.html",replace:!0,link:function(e,t,r,n){var a=t.find(".sidebar-btn-backtop"),i=function(){return Math.max(document.documentElement.scrollTop||0,document.body.scrollTop||0)},o=function(){var r,n=t[0];r=e.isSidebarOpen?"translate3d(0, 0, 0)":"translate3d(-295px, 0, 0)",n.style.webkitTransform=r,n.style.msTransform=r,n.style.transform=r,e.isSidebarOpen=!e.isSidebarOpen},l=function(){a.css("visibility",i()>300?"visible":"hidden")};l(),e.activeTemplate=null,e.isSidebarOpen=!1,e.toggleSidebar=o,angular.$(window).on("scroll",l),a.on("click",function(){$("html, body").animate({scrollTop:0},300)}),t.find(".toolbar-open").on("click",function(t){var r=angular.$(t.target),n=r.attr("template");n===e.activeTemplate?(e.activeTemplate=n,o()):e.isSidebarOpen?e.activeTemplate=n:(e.activeTemplate=n,o()),e.$apply()}),angular.$(document).on("click",function(t){e.isSidebarOpen&&!angular.$(t.target).parents(".sidebar").length&&(o(),e.$apply())})}}}).directive("carousel",function(){return{scope:{},controller:["$scope","$element",function(e,t){var r,n=e.slides=[],a=0,i=t.find("ul"),o=function(){r=setTimeout(function(){var t=a+1;t>n.length-1&&(t=0),e.setActiveSlide(t),e.$digest(),o()},5e3)};setTimeout(function(){o()},0);var l=function(){clearTimeout(r),r=null};t.bind("mouseenter",function(){l()}),t.bind("mouseleave",function(){o()}),e.setActiveSlide=function(e){angular.forEach(n,function(e){e.active=!1});var t;"number"==typeof e?(t=e,e=n[t],e&&(e.active=!0)):(t=n.indexOf(e),e.active=!0),t>=0&&t<n.length&&(a=t);var r=i.parent()[0].clientHeight;i.css("top",-1*a*r+"px")},this.addSlide=function(t){0===n.length&&e.setActiveSlide(t),n.push(t)}}],restrict:"A",templateUrl:"tpls/slides/carousel.html",replace:!0,transclude:!0}}).directive("slide",function(){return{scope:{},require:"^carousel",restrict:"A",template:'<li class="carousel-block" ng-transclude></li>',replace:!0,transclude:!0,link:function(e,t,r,n){n.addSlide(e)}}}).directive("excavator",function(){return{restrict:"E",templateUrl:"tpls/excavator/excavator.html",replace:!0,link:function(e,t,r,n){e.clickedCategory=-1e4,e.changeCategory=function(t){e.clickedCategory!==t.id&&(e.clickedCategory=t.id,t.sub_categories&&t.sub_categories.length?(e.subCategories=t.sub_categories,e.activeCategory=t.id):t.id<0&&(e.subCategories=null,e.activeCategory=null))},e.option={},e.rstStream.orderBy="",e.changeOrder=function(t){switch(e.rstStream.orderBy=t,t){case"order_lead_time":e.otherOrder="配送速度";break;case"minimum_order_amount":e.otherOrder="起送价格";break;case"distance":e.otherOrder="距离最近";break;default:e.otherOrder=""}},e.rstStream.filter=function(t){return!(e.option.mimOrder&&t.minimum_order_amount>e.option.mimOrder)}}}}).directive("rstView",["templateBuilder","templateParser","$http",function(e,t,r){return{restrict:"EA",template:'<div class="clearfix"></div>',replace:!0,link:function(n,a,i,o){var l,s,c,u=140,d=4,f=!1;r.get("tpls/rst-block/rst-block.html").then(function(e){var r=e.data;l=t.parse(r),f&&(v(),f=!1)});var p=function(){a.css("height",Math.ceil(c/d)*u+"px")},m=function(t,r,n){var a={restaurant:r,$index:n};return e.build(t,a)},g=function(){var e="";if(s)for(var t=0;t<s.length;t++)e+=m(l,s[t],t);return e},v=function(e){return l?(c=s.length,p(),void a.html(g())):f=!0};n.$watchCollection(i.data,function(e){var t=e;s=e||[],v(t)})}}}]),angular.module("elemeServices",["ngResource"]).factory("slideActivities",["$resource",function(e){return e("data/slides.json")}]).factory("rstStream",["$resource",function(e){return{restaurants:e("data/restaurants.json")}}]).factory("filtername",["$resource",function(e){return e("data/category.json")}]).factory("templateParser",["$parse","$interpolate",function(e,t){function r(a){if(1===a.nodeType){var i,o,l,s,c=[],u={tagName:a.tagName.toLowerCase()},d=a.attributes;for(l=0,s=d.length;s>l;l++){var f=d[l],p=f.name,m=f.nodeValue;if(p&&"ng-"===p.substr(0,3))if(o||(o={}),p.length>8&&"ng-attr-"===p.substr(0,8))i||(i={}),i[p.substr(9)]=e(m);else if("ng-repeat"===p){var g=/(\w+)\s+in(.*?)$/.exec(m);g&&(o[p]={itemName:g[1],getArray:e(g[2])})}else o[p]=n[p]?t(m):e(m);else i||(i={}),/\s*({{\s*(.+?)\s*}})\s*/gi.test(m)?i[p]=t(m):i[p]=m}var v=a.childNodes;for(l=0,s=v.length;s>l;l++){var h=v[l];if(3!==h.nodeType)c.push(r(h));else{var y=h.nodeValue;y&&(/\s*({{\s*(.+?)\s*}})\s*/gi.test(y)?c.push(t(y)):(y=y.replace(/(\r\n|\n|\r|\s)/gm,""),y.length&&c.push(y)))}}return c.length>0&&(u.children=c),i&&(u.attrs=i),o&&(u.dirs=o),u}}var n={"ng-src":!0,"ng-href":!0};return{parse:function(e){var t=document.createElement("div");return t.innerHTML=e,r(t).children}}}]).factory("templateBuilder",function(){function e(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function t(e){var t=function(){};return t.prototype=e,new t}function r(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t+=r+":"+e[r]+";");return t}function n(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&e[r]&&t.push(r);return t.join(" ")}function a(t){var r=e(t);return r.dirs=e(t.dirs),r.dirs["ng-repeat"]=null,delete r.dirs["ng-repeat"],r}function i(e,c){var u,d,f;if(e instanceof Array){for(u="",d=0,f=e.length;f>d;d++)u+=i(e[d],c);return u}if("string"==typeof e)return e;if("function"==typeof e)return e(c);var p=e.tagName,m=e.children,g=e.attrs,v=e.dirs,h=e.textContent,y="",b="";if(v&&v["ng-repeat"]){var $=a(e),S=v["ng-repeat"],O=S.getArray(c)||s,C=S.itemName;for(u="",d=0,f=O.length;f>d;d++){var T=t(c);T.$index=d,T.$first=0===d,T.$last=d===f-1,T.$middle=!(T.$first||T.$last),T[C]=O[d],u+=i($,T)}return u}u="<"+p;for(var k in v)if(v.hasOwnProperty(k)){var x,w=v[k];if("function"==typeof w&&(x=w(c)),"ng-if"===k){if(!x)return""}else o[k]?u+=" "+k.substr(3)+'="'+x+'"':l[k]?h=x:"ng-style"===k?b=r(x)+b:"ng-class"===k?y+=n(x):("ng-show"===k||"ng-hide"===k)&&x&&(y+=" "+k)}for(var A in g)if(g.hasOwnProperty(A)){var N=g[A];"function"==typeof N&&(N=N(c)),"class"===A?y+=" "+N:u+=" "+A+'="'+N+'"'}if(y&&(u+=' class="'+y.trim()+'"'),b&&(u+=' style="'+b+'"'),u+=">",h&&(u+=h),m)for(d=0,f=m.length;f>d;d++){var _=m[d];u+=i(_,c)}return u+="</"+p+">"}var o={"ng-src":!0,"ng-href":!0,"ng-alt":!0,"ng-title":!0,"ng-id":!0,"ng-disabled":!0,"ng-value":!0},l={"ng-html":!0,"ng-bind":!0,"ng-text":!0},s=[];return{build:i}});